!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e(require("blockly/core"));else if("function"==typeof define&&define.amd)define(["blockly/core"],e);else{var o="object"==typeof exports?e(require("blockly/core")):e(t.Blockly);for(var n in o)("object"==typeof exports?exports:t)[n]=o[n]}}(this,(function(t){return function(t){var e={};function o(n){if(e[n])return e[n].exports;var s=e[n]={i:n,l:!1,exports:{}};return t[n].call(s.exports,s,s.exports,o),s.l=!0,s.exports}return o.m=t,o.c=e,o.d=function(t,e,n){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},o.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)o.d(n,s,function(e){return t[e]}.bind(null,s));return n},o.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="/dist/",o(o.s=1)}([function(e,o){e.exports=t},function(t,e,o){"use strict";o.r(e),o.d(e,"Backpack",(function(){return l})),o.d(e,"BACKPACK_OPEN",(function(){return i})),o.d(e,"BackpackOpen",(function(){return r})),o.d(e,"BACKPACK_CHANGE",(function(){return c})),o.d(e,"BackpackChange",(function(){return a})),o.d(e,"BackpackOptions",(function(){})),o.d(e,"BackpackContextMenuOptions",(function(){}));var n=o(0);
/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function s(t,e){t.emptyBackpack&&
/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */
function(t){const e=t.configureContextMenu;t.configureContextMenu=(o,s)=>{const i=t.getComponentManager().getComponent("backpack");if(!i||!i.getClientRect().contains(s.clientX,s.clientY))return void(e&&e.call(null,o,s));o.length=0;const r={text:n.Msg.EMPTY_BACKPACK,enabled:!!i.getCount(),callback:function(){i.empty()}};o.push(r)}}(e),t.removeFromBackpack&&function(){if(n.ContextMenuRegistry.registry.getItem("remove_from_backpack"))return;const t={displayText:n.Msg.REMOVE_FROM_BACKPACK,preconditionFn:function(t){const e=t.block.workspace;if(e.isFlyout&&e.targetWorkspace){const t=e.targetWorkspace.getComponentManager().getComponent("backpack");if(t&&t.getFlyout().getWorkspace().id===e.id)return"enabled"}return"hidden"},callback:function(t){t.block.workspace.targetWorkspace.getComponentManager().getComponent("backpack").removeBlock(t.block)},scopeType:n.ContextMenuRegistry.ScopeType.BLOCK,id:"remove_from_backpack",weight:200};n.ContextMenuRegistry.registry.register(t)}(),t.copyToBackpack&&function(t){if(n.ContextMenuRegistry.registry.getItem("copy_to_backpack"))return;const e={displayText:function(t){if(!t.block)return;const e=t.block.workspace.getComponentManager().getComponent("backpack").getCount();return`${n.Msg.COPY_TO_BACKPACK} (${e})`},preconditionFn:function(e){const o=e.block.workspace;if(!o.isFlyout){const n=o.getComponentManager().getComponent("backpack");if(n)return t?"enabled":n.containsBlock(e.block)?"disabled":"enabled"}return"hidden"},callback:function(t){t.block.workspace.getComponentManager().getComponent("backpack").addBlock(t.block)},scopeType:n.ContextMenuRegistry.ScopeType.BLOCK,id:"copy_to_backpack",weight:200};n.ContextMenuRegistry.registry.register(e)}(t.disablePreconditionChecks),t.copyAllToBackpack&&function(){if(n.ContextMenuRegistry.registry.getItem("copy_all_to_backpack"))return;const t={displayText:n.Msg.COPY_ALL_TO_BACKPACK,preconditionFn:function(t){const e=t.workspace;if(!e.isFlyout){if(e.getComponentManager().getComponent("backpack"))return"enabled"}return"hidden"},callback:function(t){const e=t.workspace;e.getComponentManager().getComponent("backpack").addBlocks(e.getTopBlocks())},scopeType:n.ContextMenuRegistry.ScopeType.WORKSPACE,id:"copy_all_to_backpack",weight:200};n.ContextMenuRegistry.registry.register(t)}(),t.pasteAllToBackpack&&function(){if(n.ContextMenuRegistry.registry.getItem("paste_all_from_backpack"))return;const t={displayText:function(t){if(!t.workspace)return;const e=t.workspace.getComponentManager().getComponent("backpack").getCount();return`${n.Msg.PASTE_ALL_FROM_BACKPACK} (${e})`},preconditionFn:function(t){const e=t.workspace;if(!e.isFlyout){if(e.getComponentManager().getComponent("backpack"))return"enabled"}return"hidden"},callback:function(t){const e=t.workspace;e.getComponentManager().getComponent("backpack").getContents().forEach(t=>{n.Xml.domToBlock(n.Xml.textToDom(t),e).scheduleSnapAndBump()})},scopeType:n.ContextMenuRegistry.ScopeType.WORKSPACE,id:"paste_all_from_backpack",weight:200};n.ContextMenuRegistry.registry.register(t)}()}
/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */
n.Msg.COPY_ALL_TO_BACKPACK="Copy All Blocks to Backpack",n.Msg.COPY_TO_BACKPACK="Copy to Backpack",n.Msg.EMPTY_BACKPACK="Empty",n.Msg.PASTE_ALL_FROM_BACKPACK="Paste All Blocks from Backpack",n.Msg.REMOVE_FROM_BACKPACK="Remove from Backpack";
/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */
const i="backpack_open";class r extends n.Events.UiBase{constructor(t,e){super(e),this.isOpen=t,this.type=i}toJson(){const t=super.toJson();return t.isOpen=this.isOpen,t}fromJson(t){super.fromJson(t),this.isOpen=t.isOpen}}n.registry.register(n.registry.Type.EVENT,i,r);const c="backpack_change";class a extends n.Events.UiBase{constructor(t){super(t),this.type=c}}n.registry.register(n.registry.Type.EVENT,c,a);
/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */
class l extends n.DragTarget{constructor(t,e){super(),this.workspace_=t,this.id="backpack",this.options_=function(t){const e={contextMenu:{emptyBackpack:!0,removeFromBackpack:!0,copyToBackpack:!0,copyAllToBackpack:!1,pasteAllToBackpack:!1,disablePreconditionChecks:!1}};if(!t)return e;const o={};return o.contextMenu={...e.contextMenu,...t.contextMenu},o}(e),this.flyout_=null,this.contents_=[],this.boundEvents_=[],this.left_=0,this.top_=0,this.WIDTH_=40,this.HEIGHT_=60,this.MARGIN_VERTICAL_=20,this.MARGIN_HORIZONTAL_=20,this.HOTSPOT_MARGIN_=10,this.svgGroup_=null,this.SPRITE_TOP_=10,this.SPRITE_LEFT_=20,this.SPRITE_SIZE_=80}init(){this.workspace_.getComponentManager().addComponent({component:this,weight:2,capabilities:[n.ComponentManager.Capability.AUTOHIDEABLE,n.ComponentManager.Capability.DRAG_TARGET,n.ComponentManager.Capability.POSITIONABLE]}),this.initFlyout_(),this.createDom_(),this.attachListeners_(),s(this.options_.contextMenu,this.workspace_),this.initialized_=!0,this.workspace_.resize()}dispose(){this.svgGroup_&&n.utils.dom.removeNode(this.svgGroup_);for(const t of this.boundEvents_)n.unbindEvent_(t);this.boundEvents_.length=0}initFlyout_(){const t=new n.Options({scrollbars:!0,parentWorkspace:this.workspace_,rtl:this.workspace_.RTL,oneBasedIndex:this.workspace_.options.oneBasedIndex,renderer:this.workspace_.options.renderer,rendererOverrides:this.workspace_.options.rendererOverrides,move:{scrollbars:!0}});if(this.workspace_.horizontalLayout){t.toolboxPosition=this.workspace_.toolboxPosition===n.utils.toolbox.Position.TOP?n.utils.toolbox.Position.BOTTOM:n.utils.toolbox.Position.TOP;const e=n.registry.getClassFromOptions(n.registry.Type.FLYOUTS_HORIZONTAL_TOOLBOX,this.workspace_.options,!0);this.flyout_=new e(t)}else{t.toolboxPosition=this.workspace_.toolboxPosition===n.utils.toolbox.Position.RIGHT?n.utils.toolbox.Position.LEFT:n.utils.toolbox.Position.RIGHT;const e=n.registry.getClassFromOptions(n.registry.Type.FLYOUTS_VERTICAL_TOOLBOX,this.workspace_.options,!0);this.flyout_=new e(t)}this.workspace_.getParentSvg().parentNode.appendChild(this.flyout_.createDom(n.utils.Svg.SVG)),this.flyout_.init(this.workspace_)}createDom_(){this.svgGroup_=n.utils.dom.createSvgElement(n.utils.Svg.G,{},null);const t=n.utils.genUid(),e=n.utils.dom.createSvgElement(n.utils.Svg.CLIPPATH,{id:"blocklyBackpackClipPath"+t},this.svgGroup_);n.utils.dom.createSvgElement(n.utils.Svg.RECT,{width:this.WIDTH_,height:this.HEIGHT_},e),this.svgImg_=n.utils.dom.createSvgElement(n.utils.Svg.IMAGE,{class:"blocklyBackpack","clip-path":"url(#blocklyBackpackClipPath"+t+")",width:this.SPRITE_SIZE_+"px",x:-this.SPRITE_LEFT_,height:this.SPRITE_SIZE_+"px",y:-this.SPRITE_TOP_},this.svgGroup_),this.svgImg_.setAttributeNS(n.utils.dom.XLINK_NS,"xlink:href",p),n.utils.dom.insertAfter(this.svgGroup_,this.workspace_.getBubbleCanvas())}attachListeners_(){this.addEvent_(this.svgGroup_,"mousedown",this,this.blockMouseDownWhenOpenable_),this.addEvent_(this.svgGroup_,"mouseup",this,this.onClick_),this.addEvent_(this.svgGroup_,"mouseover",this,this.onMouseOver_),this.addEvent_(this.svgGroup_,"mouseout",this,this.onMouseOut_)}addEvent_(t,e,o,s){const i=n.browserEvents.bind(t,e,o,s);this.boundEvents_.push(i)}getFlyout(){return this.flyout_}getClientRect(){if(!this.svgGroup_)return null;const t=this.svgGroup_.getBoundingClientRect(),e=t.top+this.SPRITE_TOP_-this.HOTSPOT_MARGIN_,o=e+this.HEIGHT_+2*this.HOTSPOT_MARGIN_,s=t.left+this.SPRITE_LEFT_-this.HOTSPOT_MARGIN_,i=s+this.WIDTH_+2*this.HOTSPOT_MARGIN_;return new n.utils.Rect(e,o,s,i)}getBoundingRectangle(){return new n.utils.Rect(this.top_,this.top_+this.HEIGHT_,this.left_,this.left_+this.WIDTH_)}position(t,e){if(!this.initialized_)return;const o=this.workspace_.scrollbar&&this.workspace_.scrollbar.canScrollHorizontally(),s=this.workspace_.scrollbar&&this.workspace_.scrollbar.canScrollVertically();t.toolboxMetrics.position===n.TOOLBOX_AT_LEFT||this.workspace_.horizontalLayout&&!this.workspace_.RTL?(this.left_=t.absoluteMetrics.left+t.viewMetrics.width-this.WIDTH_-this.MARGIN_HORIZONTAL_,o&&!this.workspace_.RTL&&(this.left_-=n.Scrollbar.scrollbarThickness)):(this.left_=this.MARGIN_HORIZONTAL_,o&&this.workspace_.RTL&&(this.left_+=n.Scrollbar.scrollbarThickness));const i=t.toolboxMetrics.position===n.TOOLBOX_AT_BOTTOM;i?(this.top_=t.absoluteMetrics.top+t.viewMetrics.height-this.HEIGHT_-this.MARGIN_VERTICAL_,s&&(this.top_-=n.Scrollbar.scrollbarThickness)):this.top_=t.absoluteMetrics.top+this.MARGIN_VERTICAL_;let r=this.getBoundingRectangle();for(let t,o=0;t=e[o];o++)r.intersects(t)&&(this.top_=i?t.top-this.HEIGHT_-this.MARGIN_VERTICAL_:t.bottom+this.MARGIN_VERTICAL_,r=this.getBoundingRectangle(),o=-1);this.svgGroup_.setAttribute("transform","translate("+this.left_+","+this.top_+")")}getCount(){return this.contents_.length}getContents(){return[...this.contents_]}onDrop(t){t instanceof n.BlockSvg&&this.addBlock(t)}blockToCleanXmlString_(t){return function(t){const e=t.cloneNode(!0);let o=e;for(;o;){o.removeAttribute&&(o.removeAttribute("x"),o.removeAttribute("y"),o.removeAttribute("id"),o.removeAttribute("disabled"),"comment"==o.nodeName&&(o.removeAttribute("h"),o.removeAttribute("w"),o.removeAttribute("pinned")));let t=o.firstChild||o.nextSibling;if(!t)for(t=o.parentNode;t;){if(t.nextSibling){t=t.nextSibling;break}t=t.parentNode}o=t}return n.Xml.domToText(e)}(n.Xml.blockToDom(t))}containsBlock(t){const e=this.blockToCleanXmlString_(t);return-1!==this.contents_.indexOf(e)}addBlock(t){this.addItem(this.blockToCleanXmlString_(t))}addBlocks(t){const e=t.map(this.blockToCleanXmlString_);this.addItems(e)}removeBlock(t){this.removeItem(this.blockToCleanXmlString_(t))}addItem(t){this.addItems([t])}addItems(t){const e=this.filterDuplicates_(t);e.length&&(this.contents_.unshift(...e),this.onContentChange_())}removeItem(t){const e=this.contents_.indexOf(t);-1!==e&&(this.contents_.splice(e,1),this.onContentChange_())}setContents(t){this.contents_=[],this.contents_=this.filterDuplicates_(t),this.onContentChange_()}empty(){this.getCount()&&(this.contents_.length&&(this.contents_=[],this.onContentChange_()),this.close())}onContentChange_(){this.maybeRefreshFlyoutContents_(),n.Events.fire(new a(this.workspace_.id))}filterDuplicates_(t){return t.filter((e,o)=>t.indexOf(e)===o&&-1===this.contents_.indexOf(e))}isOpenable_(){return!this.isOpen()}isOpen(){return this.flyout_.isVisible()}open(){if(!this.isOpenable_())return;const t=this.contents_.map(t=>n.Xml.textToDom(t));this.flyout_.show(t),n.Events.fire(new r(!0,this.workspace_.id))}maybeRefreshFlyoutContents_(){if(!this.isOpen())return;const t=this.contents_.map(t=>n.Xml.textToDom(t));this.flyout_.show(t)}close(){this.isOpen()&&(this.flyout_.hide(),n.Events.fire(new r(!1,this.workspace_.id)))}autoHide(t){t||this.close()}onClick_(t){if(n.utils.isRightButton(t))return;this.open();const e=new(n.Events.get(n.Events.CLICK))(null,this.workspace_.id,"backpack");n.Events.fire(e)}onDragEnter(t){t instanceof n.BlockSvg&&this.updateHoverStying_(!0)}onDragExit(t){this.updateHoverStying_(!1)}onMouseOver_(){this.isOpenable_()&&this.updateHoverStying_(!0)}onMouseOut_(){this.updateHoverStying_(!1)}updateHoverStying_(t){t?n.utils.dom.addClass(this.svgImg_,"blocklyBackpackDarken"):n.utils.dom.removeClass(this.svgImg_,"blocklyBackpackDarken")}shouldPreventMove(t){return t instanceof n.BlockSvg}blockMouseDownWhenOpenable_(t){!n.utils.isRightButton(t)&&this.isOpenable_()&&t.stopPropagation()}}const p="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGVuYWJsZS1iYWNrZ3JvdW5kPSJuZXcgMCAwIDI0IDI0IiBoZWlnaHQ9IjI0cHgiIHZpZXdCb3g9IjAgMCAyNCAyNCIgd2lkdGg9IjI0cHgiIGZpbGw9IiM0NTVBNjQiPjxnPjxyZWN0IGZpbGw9Im5vbmUiIGhlaWdodD0iMjQiIHdpZHRoPSIyNCIvPjwvZz48Zz48Zy8+PGc+PHBhdGggZD0iTTEzLjk3LDUuMzRDMTMuOTgsNS4yMywxNCw1LjEyLDE0LDVjMC0xLjEtMC45LTItMi0ycy0yLDAuOS0yLDJjMCwwLjEyLDAuMDIsMC4yMywwLjAzLDAuMzRDNy42OSw2LjE1LDYsOC4zOCw2LDExdjggYzAsMS4xLDAuOSwyLDIsMmg4YzEuMSwwLDItMC45LDItMnYtOEMxOCw4LjM4LDE2LjMxLDYuMTUsMTMuOTcsNS4zNHogTTExLDVjMC0wLjU1LDAuNDUtMSwxLTFzMSwwLjQ1LDEsMSBjMCwwLjAzLTAuMDEsMC4wNi0wLjAyLDAuMDlDMTIuNjYsNS4wMywxMi4zNCw1LDEyLDVzLTAuNjYsMC4wMy0wLjk4LDAuMDlDMTEuMDEsNS4wNiwxMSw1LjAzLDExLDV6IE0xNiwxM3YxdjAuNSBjMCwwLjI4LTAuMjIsMC41LTAuNSwwLjVTMTUsMTQuNzgsMTUsMTQuNVYxNHYtMUg4di0xaDdoMVYxM3oiLz48L2c+PC9nPjwvc3ZnPg==";n.Css.register([".blocklyBackpack {\n    opacity: .4;\n  }\n  .blocklyBackpackDarken {\n    opacity: .6;\n  }\n  .blocklyBackpack:active {\n    opacity: .8;\n  }"])}])}));
//# sourceMappingURL=index.js.map